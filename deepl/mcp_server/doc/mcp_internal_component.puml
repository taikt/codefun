@startuml
top to bottom direction
skinparam linetype ortho
skinparam ComponentSpacing 130
skinparam NodeSpacing 100
skinparam PackagePadding 80

package "MCP Server" #LightBlue {
  component "Controller" as CONTROLLER
  component "ToolHandler"
  component "PromptHandler"
  component "ResourceHandler"
  package "Analyzers" {
    component "MemoryAnalyzer"
    component "ResourceAnalyzer"
    component "RaceAnalyzer"
  }
  component "RuleFetcher"
  component "PromptTemplates"
  component "ResourceFiles"

  CONTROLLER --> ToolHandler : @app.call_tool, @app.list_tools
  CONTROLLER --> PromptHandler : @app.get_prompt, @app.list_prompts
  CONTROLLER --> ResourceHandler : @app.list_resources

  ToolHandler --> MemoryAnalyzer
  ToolHandler --> ResourceAnalyzer
  ToolHandler --> RaceAnalyzer
  ToolHandler --> RuleFetcher

  PromptHandler --> PromptTemplates
  PromptHandler --> MemoryAnalyzer
  PromptHandler --> ResourceAnalyzer
  PromptHandler --> RaceAnalyzer

  ResourceHandler --> ResourceFiles
}

@enduml