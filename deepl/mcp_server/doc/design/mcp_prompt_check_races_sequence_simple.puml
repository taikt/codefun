@startuml
actor "Copilot Chat (client)" as copilot
box "MCP Server" #LightBlue
  participant "Controller" as controller
  participant "PromptHandler" as promptHandler
  participant "Tool Handler" as toolHandler
  participant "RaceAnalyzer" as raceAnalyzer
end box
participant "Storage" as storage #yellow

autonumber
copilot -> controller : get_prompt (check_races)
controller -> promptHandler : handle_prompt("check_races")
promptHandler -> toolHandler : _handle_detect_races()
toolHandler -> raceAnalyzer : analyze_codebase()
raceAnalyzer -> storage : read C++ files
storage --> raceAnalyzer : file contents
raceAnalyzer --> toolHandler : metadata (potential races, summary),C++ contents
toolHandler --> promptHandler : findings
promptHandler --> controller : prompt (with findings)
controller --> copilot : prompt (with findings)
@enduml
