@startuml
actor "Copilot Chat (client)" as copilot
box "MCP Server" #LightBlue
  participant "Controller" as controller
  participant "PromptHandler" as promptHandler
  participant "Tool Handler" as toolHandler
  participant "ResourceAnalyzer" as resourceAnalyzer
end box
participant "Storage" as storage #yellow

autonumber
copilot -> controller : get_prompt (check_resources)
controller -> promptHandler : handle_prompt("check_resources")
promptHandler -> toolHandler : _handle_ai_resource_analysis()
toolHandler -> resourceAnalyzer : analyze_codebase()
resourceAnalyzer -> storage : read C++ files
storage --> resourceAnalyzer : file contents
resourceAnalyzer --> toolHandler : metadata (resource leaks, summary), C++ contents
toolHandler --> promptHandler : findings
promptHandler --> controller : prompt (with findings)
controller --> copilot : prompt (with findings)
@enduml
