@startuml
actor "Copilot Chat (client)" as copilot
box "MCP Server" #LightBlue
  participant "Controller" as controller
  participant "PromptHandler" as promptHandler
  participant "Tool Handler" as toolHandler
  participant "MemoryAnalyzer" as memoryAnalyzer
end box
participant "Storage" as storage #yellow

autonumber
copilot -> controller : get_prompt (check_leaks)
controller -> promptHandler : handle_prompt("check_leaks")
promptHandler -> toolHandler : _handle_memory_analysis()
toolHandler -> memoryAnalyzer : analyze_codebase()
memoryAnalyzer -> storage : read C++ files
storage --> memoryAnalyzer : file contents
memoryAnalyzer --> toolHandler : metadata (leaks, summary),C++ contents
toolHandler --> promptHandler : findings
promptHandler --> controller : prompt (with findings)
controller --> copilot : prompt (with findings)
@enduml
